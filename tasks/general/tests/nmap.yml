---
# Nmap port test

- name: General | Tests | nmap | Set Facts
  set_fact:
    nmap_file: "{{ user_user.home }}/Reports/{{ nmap_report }}"
    nmap_separator: "\n*******************************\n\n"

- name: General | Tests | nmap | Date Header
  shell: "date > {{ nmap_file }}"

- name: General | Tests | nmap | Add Separator
  shell: "printf '{{ nmap_separator }}' >> {{ nmap_file }}"

- name: General | Tests | nmap | Open Report Description
  shell: "echo '-=Open Ports=-' >> {{ nmap_file }}"

- name: General | Tests | nmap | Count Description
  shell: "printf 'Number of open ports: ' >> {{ nmap_file }}"

- name: General | Tests | nmap | Run Count
  shell: "nmap --open localhost | grep -c open >> {{ nmap_file }}; echo success"

- name: General | Tests | nmap | Run Open
  shell: "nmap --open localhost | grep open >> {{ nmap_file }}; echo success"

- name: General | Tests | nmap | Add Separator
  shell: "printf '{{ nmap_separator }}' >> {{ nmap_file }}"

- name: General | Tests | nmap | Aggressive Report Description
  shell: "echo '-=Aggressive Vulnerability Check=-' >> {{ nmap_file }}"

- name: General | Tests | nmap | Run Aggressive
  shell: "nmap -A localhost >> {{ nmap_file }}; echo success"

- name: General | Tests | nmap | Make Viewable
  file:
    path: "{{ nmap_file }}"
    mode: '0644'
